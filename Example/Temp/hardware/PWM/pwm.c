#include "pwm.h"
#include "stc8.h"

void Pwm_set(float L, float R)
{
   if (L >= 100)
   {
      L = 100;
   }
   else if (L <= -100)
   {
      L = -100;
   }

   if (R >= 100)
   {
      R = 100;
   }
   else if (R <= -100)
   {
      R = -100;
   }

   P_SW2 = 0x80;  //ï¿½ï¿½Òªï¿½ï¿½ï¿½ï¿½ï¿½Î»EAXFRï¿½ï¿½ï¿½ï¿½Îª1ï¿½ï¿½ï¿½Ü·ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿?
   PWMCKS = 0x00; //PWMÊ±ï¿½ï¿½Ñ¡ï¿½ï¿½ï¿½Æ? 0x00ï¿½ï¿½ï¿½ï¿½Æµ
   PWMC = 0x1500; //ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµ
   if (L > 0)
   {

      PWM2T1 = (PWMC * (L / 100)); //ï¿½ßµÍµï¿½Æ½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµ
      PWM2CR = 0x80;
      P24 = 0;
      //PWM1T2=0x0300;
      //PWM4T1=PWMC-PWM2T1;
   }
   else
   {
      L = -L;
      //PWM4T1=(PWMC*(L/100)); //ï¿½ßµÍµï¿½Æ½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Öµ
      PWM4T1 = (PWMC * (L / 100));
      P22 = 0;
      PWM4CR = 0x80;
   }
   if (R > 0)
   {
      PWM3T1 = (PWMC * (R / 100));
      P26 = 0;
      PWM3CR = 0x80;
   }
   else
   {

      R = -R;
      PWM6T1 = (PWMC * (R / 100));
      P23 = 0;
      PWM6CR = 0x80;
   }
   P_SW2 = 0x00; //ï¿½Ø±Õ¼Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½

   PWMCR = 0x80; //Ê¹ï¿½ï¿½PWMï¿½ï¿½
}