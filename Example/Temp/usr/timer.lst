C51 COMPILER V9.53.0.0   TIMER                                                             07/17/2020 01:13:22 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\timer.obj
COMPILER INVOKED BY: F:\MDK5\C51\BIN\C51.EXE ..\hardware\timer\timer.c LARGE OMF2 OPTIMIZE(2,SPEED) BROWSE INCDIR(..\har
                    -dware\delay;..\hardware\IIC;..\hardware\OLED;..\hardware\ADC;..\hardware\Mpu6050;..\hardware\KEY;..\hardware\LED;..\hard
                    -ware\PWM;..\hardware\pca;..\hardware\timer;..\hardware\PID) DEBUG PRINT(.\timer.lst) TABS(3) OBJECT(.\timer.obj)

line level    source

   1          #include "timer.h"
   2          #include "LED.h"
   3          int flag = 0;
   4          void Timer_uart_init() //串口中断初始化
   5          {
   6   1         SCON |= 0x50;                          //REN=1允许串行接受状态，串口工作模式2
   7   1         TMOD |= 0x00;                          //定时器1为模式0（16位自动重载）
   8   1         AUXR = 0X40;                           //开启1T模式`    PS：这一行不能或等于不然串口无法打开
   9   1         TL1 = (65535 - (24000000 / 4 / 9600)); //设置波特率重装值
  10   1         TH1 = (65535 - (24000000 / 4 / 9600)) >> 8;
  11   1         TR1 = 1; //开启定时器1
  12   1         ES = 1;  //开串口中断
  13   1         EA = 1;  // 开总中断
  14   1      }
  15          
  16          void Timer0_init() //定时器中断0初始化
  17          {
  18   1         TMOD |= 0x00;
  19   1         //AUXR|=0x80; //开启1T模式
  20   1         TL0 = 0x30; //定时器1ms
  21   1         TH0 = 0xf8;
  22   1         TR0 = 1;
  23   1         ET0 = 1;
  24   1         EA = 1;
  25   1      }
  26          
  27          void speed_count_init() //设定T3T4计数器读取编码器的值
  28          {
  29   1         T3L = 0x00;
  30   1         T3H = 0x00;
  31   1      
  32   1         T4L = 0x00;
  33   1         T4H = 0x00;
  34   1      
  35   1         IE2 = 0x60;
  36   1         T4T3M = 0xcc;
  37   1      
  38   1         EA = 1;
  39   1      }
  40          
  41          float GetCarSpeed(int dat)
  42          {
  43   1         float speed;
  44   1         speed = (float)dat;
  45   1         speed = speed / 70 * 0.045 * 3.14;
  46   1         speed = speed * 20;
  47   1         return speed;
  48   1      }
  49          
  50          void time0_itp() interrupt 1 //定时器0中断服务函数
  51          {
  52   1         static int cnt = 0; //设置计数 到50读取计数器计数值
  53   1         if (cnt >= 50)
C51 COMPILER V9.53.0.0   TIMER                                                             07/17/2020 01:13:22 PAGE 2   

  54   1         {
  55   2            flag = 1;
  56   2            cnt = 0;
  57   2            LED = ~LED;
  58   2         }
  59   1         cnt++;
  60   1      }
  61          void TM3() interrupt 19
  62          {
  63   1         //LED = !LED;
  64   1         AUXINTIF &= ~T3IF;
  65   1      }
  66          
  67          void TM4() interrupt 20
  68          {
  69   1         //LED = !LED;
  70   1         AUXINTIF &= ~T4IF;
  71   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    270    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      4       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
