C51 COMPILER V9.53.0.0   PWM                                                               07/23/2020 05:14:10 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE PWM
OBJECT MODULE PLACED IN .\pwm.obj
COMPILER INVOKED BY: F:\MDK5\C51\BIN\C51.EXE ..\hardware\PWM\pwm.c LARGE OMF2 OPTIMIZE(2,SPEED) BROWSE INCDIR(..\hardwar
                    -e\delay;..\hardware\IIC;..\hardware\OLED;..\hardware\ADC;..\hardware\Mpu6050;..\hardware\KEY;..\hardware\LED;..\hardware
                    -\PWM;..\hardware\pca;..\hardware\timer;..\hardware\PID;..\hardware\CCD;..\hardware\UART;..\hardware\Motor) DEBUG PRINT(.
                    -\pwm.lst) TABS(3) OBJECT(.\pwm.obj)

line level    source

   1          #include "pwm.h"
   2          #include "stc8.h"
   3          
   4          void Pwm_set(float L, float R)
   5          {
   6   1         if (L >= 4000)  //限制进入计算的pid值为5000到-5000之间
   7   1         {
   8   2            L = 4000;
   9   2         }
  10   1         else if (L <= -4000)
  11   1         {
  12   2            L = -4000;
  13   2         }
  14   1      
  15   1         if (R >= 4000)
  16   1         {
  17   2            R = 4000;
  18   2         }
  19   1         else if (R <= -4000)
  20   1         {
  21   2            R = -4000;
  22   2         }
  23   1      
  24   1         P_SW2 = 0x80; //pwm配置
  25   1         PWMCKS = 0x00;
  26   1         PWMC = 0x0600; //设置初始的pwm值
  27   1         if (L > 0)
  28   1         {
  29   2      
  30   2            PWM2T1 = (PWMC * (L / 5000)); //T2高电平时间
  31   2            PWM2CR = 0x80;
  32   2            PWM4CR = 0x00;
  33   2            P24 = 0;
  34   2            
  35   2         }
  36   1         else if(L == 0)
  37   1         {
  38   2            PWM2CR = 0x00;
  39   2            PWM4CR = 0x00;
  40   2            P22 = 0;
  41   2            P24 = 0;
  42   2           
  43   2         }
  44   1            
  45   1         else
  46   1         {
  47   2            L = -L;
  48   2            PWM4T1 = (PWMC * (L / 5000));
  49   2            PWM2CR = 0x00;
  50   2            P22 = 0;
  51   2            PWM4CR = 0x80;
  52   2         }
C51 COMPILER V9.53.0.0   PWM                                                               07/23/2020 05:14:10 PAGE 2   

  53   1         if (R > 0)
  54   1         {
  55   2            PWM3T1 = (PWMC * (R / 5000));
  56   2            PWM6CR = 0x00;
  57   2            P26 = 0;
  58   2            PWM3CR = 0x80;
  59   2         }
  60   1         else if(R == 0)
  61   1         {
  62   2            PWM3CR = 0x00;
  63   2            PWM6CR = 0x00;
  64   2            P23 = 0;
  65   2            P26 = 0;
  66   2         }
  67   1         else
  68   1         {
  69   2      
  70   2            R = -R;
  71   2            PWM6T1 = (PWMC * (R / 5000));
  72   2            PWM3CR = 0x00;
  73   2            P23 = 0;
  74   2            PWM6CR = 0x80;
  75   2         }
  76   1         P_SW2 = 0x00;
  77   1      
  78   1         PWMCR = 0x80; //使能pwm波
  79   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    734    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
